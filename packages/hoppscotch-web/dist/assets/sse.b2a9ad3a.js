import{_ as h}from"./utils.15e00fb8.js";import{d as A,W as P,_ as C}from"./regex.849f578a.js";import{_ as I}from"./Primary.vue_vue_type_script_setup_true_lang.d4d43153.js";import{f as N,E as G,aq as V,ar as m,d4 as O,d5 as U,U as B,h as K,W as M,al as W,d6 as f,av as z,o as j,c as q,w as b,e as l,i as y,v as _,j as e,Y as E,K as H,k as g,t as Y,a as T,$ as F,d7 as J,d8 as Q,d9 as X,da as Z,db as ee,dc as se,dd as te}from"./index.86d7e4bf.js";import"./trash.d63c0dc1.js";import"./Tab.vue_vue_type_script_setup_true_lang.224a8ebb.js";import"./lens-actions.83d153d5.js";import"./json.0cd2bd86.js";import"./newOutline.88614fe9.js";import"./date.c9b8c764.js";const oe={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 overflow-x-auto space-x-2 bg-primary"},ae={class:"inline-flex flex-1 space-x-2"},re={class:"flex flex-1"},ne=["placeholder","disabled"],le={for:"event-type",class:"px-4 py-2 font-semibold truncate border-t border-b bg-primaryLight border-divider text-secondaryLight"},ie=["disabled"],Ee=N({__name:"sse",setup(de){const t=G(),v=F(),{subscribeToStream:x}=V(),d=m(U,new O,J),r=B(d.value.connectionState$,"STOPPED"),o=m(X,"",Q),c=m(ee,"",Z),u=m(te,[],se),i=K(!0);let p;const k=A(function(){p.postMessage({type:"sse",url:o.value})},1e3);M(o,s=>{s&&k()});const $=({data:s})=>{s.url===o.value&&(i.value=s.result)};W(()=>{p=new P,p.addEventListener("message",$),x(d.value.event$,s=>{switch(s==null?void 0:s.type){case"STARTING":u.value=[{payload:`${t("state.connecting_to",{name:o.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"STARTED":u.value=[{payload:`${t("state.connected_to",{name:o.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],v.success(`${t("state.connected")}`);break;case"MESSAGE_RECEIVED":f({payload:s.message,source:"server",ts:s.time});break;case"ERROR":f({payload:t("error.browser_support_sse").toString(),source:"info",color:"#ff5555",ts:s.time});break;case"STOPPED":f({payload:t("state.disconnected_from",{name:o.value}).toString(),source:"disconnected",color:"#ff5555",ts:s.time}),v.error(`${t("state.disconnected")}`);break}})});const S=()=>{if(r.value==="STOPPED")return d.value.start(o.value,c.value);d.value.stop()};z(()=>{p.terminate()});const w=()=>{u.value=[]};return(s,a)=>{const R=I,D=C,L=h;return j(),q(L,{"layout-id":"sse"},{primary:b(()=>[l("div",oe,[l("div",ae,[l("div",re,[y(l("input",{id:"server","onUpdate:modelValue":a[0]||(a[0]=n=>E(o)?o.value=n:null),type:"url",autocomplete:"off",class:H([{error:!i.value},"flex flex-1 w-full px-4 py-2 border rounded-l bg-primaryLight border-divider text-secondaryDark"]),placeholder:e(t)("sse.url"),disabled:e(r)==="STARTED"||e(r)==="STARTING",onKeyup:a[1]||(a[1]=g(n=>i.value?S():null,["enter"]))},null,42,ne),[[_,e(o)]]),l("label",le,Y(e(t)("sse.event_type")),1),y(l("input",{id:"event-type","onUpdate:modelValue":a[2]||(a[2]=n=>E(c)?c.value=n:null),class:"flex flex-1 w-full px-4 py-2 border rounded-r bg-primaryLight border-divider text-secondaryDark",spellcheck:"false",disabled:e(r)==="STARTED"||e(r)==="STARTING",onKeyup:a[3]||(a[3]=g(n=>i.value?S():null,["enter"]))},null,40,ie),[[_,e(c)]])]),T(R,{id:"start",disabled:!i.value,name:"start",class:"w-32",label:e(r)==="STARTING"?e(t)("action.starting"):e(r)==="STOPPED"?e(t)("action.start"):e(t)("action.stop"),loading:e(r)==="STARTING",onClick:S},null,8,["disabled","label","loading"])])])]),secondary:b(()=>[T(D,{title:e(t)("sse.log"),log:e(u),onDelete:a[4]||(a[4]=n=>w())},null,8,["title","log"])]),_:1})}}});export{Ee as default};
//# sourceMappingURL=sse.b2a9ad3a.js.map
