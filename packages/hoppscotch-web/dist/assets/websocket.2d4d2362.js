import{_ as ee}from"./utils.15e00fb8.js";import{W as oe,d as te,_ as ae}from"./regex.849f578a.js";import{a as se,_ as ne}from"./Tab.vue_vue_type_script_setup_true_lang.224a8ebb.js";import{f as le,E as ce,aq as re,h as E,ar as h,g as ie,as as de,at as ue,U as me,W as L,al as pe,au as k,av as ge,o as O,c as ve,w as m,e as n,i as d,v as V,j as e,Y as M,K as R,k as fe,a as l,t as G,d as _e,m as be,$ as ye,aw as he,ax as ke,ay as Ce,az as Se,x as we,z as Ee,a0 as xe,aA as $e,aB as Ne,aC as Ie,aD as De,aE as Te,aF as Pe,aG as We}from"./index.86d7e4bf.js";import{_ as Le}from"./Communication.vue_vue_type_script_setup_true_lang.edcb9746.js";import{_ as Oe}from"./Primary.vue_vue_type_script_setup_true_lang.d4d43153.js";import{I as Ve}from"./json.53fc22d3.js";import{I as Me,d as Re}from"./vuedraggable.umd.7c1d0268.js";import{I as U}from"./check-circle.3a02b99a.js";import{I as Ge}from"./circle.f91b5512.js";import{I as Ue}from"./grip-vertical.087b226f.js";import{I as ze}from"./trash.d63c0dc1.js";import"./lens-actions.83d153d5.js";import"./json.0cd2bd86.js";import"./newOutline.88614fe9.js";import"./date.c9b8c764.js";import"./help-circle.a017c8ce.js";import"./TaskOption.1829462a.js";import"./files.413363e2.js";const Be={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 space-x-2 overflow-x-auto bg-primary"},je={class:"inline-flex flex-1 space-x-2"},Ae=["placeholder","disabled"],Fe={class:"sticky z-10 flex items-center justify-between flex-shrink-0 pl-4 overflow-x-auto border-b bg-primary border-dividerLight top-upperSecondaryStickyFold"},Ke={class:"font-semibold truncate text-secondaryLight"},qe={class:"flex"},He={class:"flex border-b divide-x divide-dividerLight border-dividerLight draggable-content group"},Ye=["onUpdate:modelValue","placeholder","onChange"],Je={key:0,class:"flex flex-col items-center justify-center p-4 text-secondaryLight"},Qe=["src","alt"],Xe={class:"mb-4 text-center"},ho=le({__name:"websocket",setup(Ze){const t=ce(),C=ye(),z=xe(),{subscribeToStream:B}=re(),x=E("communication"),c=h(Ne,"",$e),r=h(De,[],Ie),S=ie({get(){return r.value.map((o,a)=>({id:`protocol-${a}-${o.value}`,protocol:o}))},set(o){r.value=o.map(({protocol:a})=>a)}}),p=h(ue,new de,Te),i=me(p.value.connectionState$,"DISCONNECTED"),b=h(We,[],Pe),y=E(!0),$=E([]);let g;L(c,o=>{o&&K()}),L(r,o=>{$.value=o.filter(a=>Object.prototype.hasOwnProperty.call(a,"active")?a.active===!0:!0).map(({value:a})=>a)},{deep:!0});const j=({data:o})=>{o.url===c.value&&(y.value=o.result)},A=o=>o instanceof SyntaxError?o.message:t("error.something_went_wrong").toString();pe(()=>{g=new oe,g.addEventListener("message",j),B(p.value.event$,o=>{switch(o==null?void 0:o.type){case"CONNECTING":b.value=[{payload:`${t("state.connecting_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":b.value=[{payload:`${t("state.connected_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],C.success(`${t("state.connected")}`);break;case"MESSAGE_SENT":k({payload:o.message,source:"client",ts:Date.now()});break;case"MESSAGE_RECEIVED":k({payload:o.message,source:"server",ts:o.time});break;case"ERROR":k({payload:A(o.error),source:"info",color:"#ff5555",ts:o.time});break;case"DISCONNECTED":k({payload:t("state.disconnected_from",{name:c.value}).toString(),source:"disconnected",color:"#ff5555",ts:o.time}),C.error(`${t("state.disconnected")}`);break}})}),ge(()=>{g&&g.terminate()});const F=()=>{he()},K=te(function(){g.postMessage({type:"ws",url:c.value})},1e3),N=()=>{if(i.value==="DISCONNECTED")return p.value.connect(c.value,$.value);p.value.disconnect()},q=o=>{p.value.sendMessage(o)},H=()=>{ke({value:"",active:!0})},Y=o=>{const a=r.value.slice();Ce(o),C.success(`${t("state.deleted")}`,{duration:4e3,action:{text:`${t("action.undo")}`,onClick:(D,w)=>{r.value=a,w.goAway()}}})},I=(o,a)=>{Se(o,a)},J=()=>{b.value=[]};return(o,a)=>{const D=Oe,w=Le,T=se,v=we,Q=ne,X=ae,Z=ee,f=Ee("tippy");return O(),ve(Z,{"layout-id":"websocket"},{primary:m(()=>[n("div",Be,[n("div",je,[d(n("input",{id:"websocket-url","onUpdate:modelValue":a[0]||(a[0]=s=>M(c)?c.value=s:null),class:R(["w-full px-4 py-2 border rounded bg-primaryLight border-divider text-secondaryDark",{error:!y.value}]),type:"url",autocomplete:"off",spellcheck:"false",placeholder:`${e(t)("websocket.url")}`,disabled:e(i)==="CONNECTED"||e(i)==="CONNECTING",onKeyup:a[1]||(a[1]=fe(s=>y.value?N():null,["enter"]))},null,42,Ae),[[V,e(c)]]),l(D,{id:"connect",disabled:!y.value,class:"w-32",name:"connect",label:e(i)==="CONNECTING"?e(t)("action.connecting"):e(i)==="DISCONNECTED"?e(t)("action.connect"):e(t)("action.disconnect"),loading:e(i)==="CONNECTING",onClick:N},null,8,["disabled","label","loading"])])]),l(Q,{modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=s=>x.value=s),styles:"sticky overflow-x-auto flex-shrink-0 bg-primary top-upperPrimaryStickyFold z-10","render-inactive-tabs":""},{default:m(()=>[l(T,{id:"communication",label:`${e(t)("websocket.communication")}`},{default:m(()=>[l(w,{"is-connected":e(i)==="CONNECTED","sticky-header-styles":"top-upperSecondaryStickyFold",onSendMessage:a[2]||(a[2]=s=>q(s))},null,8,["is-connected"])]),_:1},8,["label"]),l(T,{id:"protocols",label:`${e(t)("websocket.protocols")}`},{default:m(()=>[n("div",Fe,[n("label",Ke,G(e(t)("websocket.protocols")),1),n("div",qe,[d(l(v,{title:e(t)("action.clear_all"),icon:e(Ve),onClick:F},null,8,["title","icon"]),[[f,{theme:"tooltip"}]]),d(l(v,{title:e(t)("add.new"),icon:e(Me),onClick:H},null,8,["title","icon"]),[[f,{theme:"tooltip"}]])])]),l(e(Re),{modelValue:e(S),"onUpdate:modelValue":a[3]||(a[3]=s=>M(S)?S.value=s:null),"item-key":"id",animation:"250",handle:".draggable-handle",draggable:".draggable-content","ghost-class":"cursor-move","chosen-class":"bg-primaryLight","drag-class":"cursor-grabbing"},{item:m(({element:{protocol:s},index:u})=>{var P,W;return[n("div",He,[n("span",null,[d(l(v,{icon:e(Ue),class:R(["cursor-auto text-primary hover:text-primary",{"draggable-handle group-hover:text-secondaryLight !cursor-grab":u!==((P=e(r))==null?void 0:P.length)-1}]),tabindex:"-1"},null,8,["icon","class"]),[[f,{theme:"tooltip",delay:[500,20],content:u!==((W=e(r))==null?void 0:W.length)-1?e(t)("action.drag_to_reorder"):null}]])]),d(n("input",{"onUpdate:modelValue":_=>s.value=_,class:"flex flex-1 px-4 py-2 bg-transparent",placeholder:`${e(t)("count.protocol",{count:u+1})}`,name:"message",type:"text",autocomplete:"off",onChange:_=>I(u,{value:_.target.value,active:s.active})},null,40,Ye),[[V,s.value]]),n("span",null,[d(l(v,{title:s.hasOwnProperty("active")?s.active?e(t)("action.turn_off"):e(t)("action.turn_on"):e(t)("action.turn_off"),icon:s.hasOwnProperty("active")?s.active?e(U):e(Ge):e(U),color:"green",onClick:_=>I(u,{value:s.value,active:!s.active})},null,8,["title","icon","onClick"]),[[f,{theme:"tooltip"}]])]),n("span",null,[d(l(v,{title:e(t)("action.remove"),icon:e(ze),color:"red",onClick:_=>Y(u)},null,8,["title","icon","onClick"]),[[f,{theme:"tooltip"}]])])])]}),_:1},8,["modelValue"]),e(r).length===0?(O(),_e("div",Je,[n("img",{src:`/images/states/${e(z).value}/add_category.svg`,loading:"lazy",class:"inline-flex flex-col object-contain object-center w-16 h-16 my-4",alt:`${e(t)("empty.protocols")}`},null,8,Qe),n("span",Xe,G(e(t)("empty.protocols")),1)])):be("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),secondary:m(()=>[l(X,{title:e(t)("websocket.log"),log:e(b),onDelete:a[5]||(a[5]=s=>J())},null,8,["title","log"])]),_:1})}}});export{ho as default};
//# sourceMappingURL=websocket.2d4d2362.js.map
